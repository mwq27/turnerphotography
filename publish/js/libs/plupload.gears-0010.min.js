(function(){if(window.google&&google.gears){return}var d=null;if(typeof GearsFactory!="undefined"){d=new GearsFactory()}else{try{d=new ActiveXObject("Gears.Factory");if(d.getBuildInfo().indexOf("ie_mobile")!=-1){d.privateSetGlobalObject(this)}}catch(c){if((typeof navigator.mimeTypes!="undefined")&&navigator.mimeTypes["application/x-googlegears"]){d=document.createElement("object");d.style.display="none";d.width=0;d.height=0;d.type="application/x-googlegears";document.documentElement.appendChild(d)}}}if(!d){return}if(!window.google){window.google={}}if(!google.gears){google.gears={factory:d}}})();(function(j,g,l,k){var i={};function h(f,d,b){var o,e,c,p;e=google.gears.factory.create("beta.canvas");try{e.decode(f);if(!d.width){d.width=e.width}if(!d.height){d.height=e.height}p=Math.min(width/e.width,height/e.height);if(p<1||(p===1&&b==="image/jpeg")){e.resize(Math.round(e.width*p),Math.round(e.height*p));if(d.quality){return e.encode(b,{quality:d.quality/100})}return e.encode(b)}}catch(a){}return f}l.runtimes.Gears=l.addRuntime("gears",{getFeatures:function(){return{dragdrop:true,jpgresize:true,pngresize:true,chunks:true,progress:true,multipart:true}},init:function(c,a){var b;if(!j.google||!google.gears){return a({success:false})}try{b=google.gears.factory.create("beta.desktop")}catch(d){return a({success:false})}function e(t){var f,q,s=[],r;for(q=0;q<t.length;q++){f=t[q];r=l.guid();i[r]=f.blob;s.push(new l.File(r,f.name,f.blob.length))}c.trigger("FilesAdded",s)}c.bind("PostInit",function(){var f=c.settings,n=g.getElementById(f.drop_element);if(n){l.addEvent(n,"dragover",function(m){b.setDropEffect(m,"copy");m.preventDefault()},c.id);l.addEvent(n,"drop",function(m){var p=b.getDragData(m,"application/x-gears-files");if(p){e(p.files)}m.preventDefault()},c.id);n=0}l.addEvent(g.getElementById(f.browse_button),"click",function(m){var s=[],u,v,t;m.preventDefault();for(u=0;u<f.filters.length;u++){t=f.filters[u].extensions.split(",");for(v=0;v<t.length;v++){s.push("."+t[v])}}b.openFiles(e,{singleFile:!f.multi_selection,filter:s})},c.id)});c.bind("UploadFile",function(f,w){var A=0,B,v,u=0,x=f.settings.resize,z;if(x&&/\.(png|jpg|jpeg)$/i.test(w.name)){i[w.id]=h(i[w.id],x,/\.png$/i.test(w.name)?"image/png":"image/jpeg")}w.size=i[w.id].length;v=f.settings.chunk_size;z=v>0;B=Math.ceil(w.size/v);if(!z){v=w.size;B=1}function y(){var s,n,p=f.settings.multipart,q=0,r={name:w.target_name||w.name},o=f.settings.url;function m(M){var N,t="----pluploadboundary"+l.guid(),K="--",I="\r\n",L,J;if(p){s.setRequestHeader("Content-Type","multipart/form-data; boundary="+t);N=google.gears.factory.create("beta.blobbuilder");l.each(l.extend(r,f.settings.multipart_params),function(C,D){N.append(K+t+I+'Content-Disposition: form-data; name="'+D+'"'+I+I);N.append(C+I)});J=l.mimeTypes[w.name.replace(/^.+\.([^.]+)/,"$1").toLowerCase()]||"application/octet-stream";N.append(K+t+I+'Content-Disposition: form-data; name="'+f.settings.file_data_name+'"; filename="'+w.name+'"'+I+"Content-Type: "+J+I+I);N.append(M);N.append(I+K+t+K+I);L=N.getAsBlob();q=L.length-M.length;M=L}s.send(M)}if(w.status==l.DONE||w.status==l.FAILED||f.state==l.STOPPED){return}if(z){r.chunk=A;r.chunks=B}n=Math.min(v,w.size-(A*v));if(!p){o=l.buildUrl(f.settings.url,r)}s=google.gears.factory.create("beta.httprequest");s.open("POST",o);if(!p){s.setRequestHeader("Content-Disposition",'attachment; filename="'+w.name+'"');s.setRequestHeader("Content-Type","application/octet-stream")}l.each(f.settings.headers,function(t,D){s.setRequestHeader(D,t)});s.upload.onprogress=function(t){w.loaded=u+t.loaded-q;f.trigger("UploadProgress",w)};s.onreadystatechange=function(){var t;if(s.readyState==4){if(s.status==200){t={chunk:A,chunks:B,response:s.responseText,status:s.status};f.trigger("ChunkUploaded",w,t);if(t.cancelled){w.status=l.FAILED;return}u+=n;if(++A>=B){w.status=l.DONE;f.trigger("FileUploaded",w,{response:s.responseText,status:s.status})}else{y()}}else{f.trigger("Error",{code:l.HTTP_ERROR,message:l.translate("HTTP Error."),file:w,chunk:A,chunks:B,status:s.status})}}};if(A<B){m(i[w.id].slice(A*v,n))}}y()});c.bind("Destroy",function(p){var f,r,q={browseButton:p.settings.browse_button,dropElm:p.settings.drop_element};for(f in q){r=g.getElementById(q[f]);if(r){l.removeAllEvents(r,p.id)}}});a({success:true})}})})(window,document,plupload);